<bci-entity-value-search-bar
  [count]="(complexValues | entityValue: searchFilter)?.length"
  [disableAddNewEntityValue]="enumeration?.isExternalReference()"
  (add)="onNew()"
  (newSearch)="searchFilter = $event"
></bci-entity-value-search-bar>

<mat-expansion-panel
  class="complex-value-items"
  expanded="true"
  *ngFor="let complexValue of complexValues | entityValue: searchFilter; trackBy: trackValue"
>
  <mat-expansion-panel-header class="complex-value-header">
    <mat-panel-title class="complex-value-bar">
      <span class="value-name">{{ complexValue.name }}</span>
      <div class="complex-value-toolbox">
        <mat-icon
          *ngIf="!enumeration?.isExternalReference()"
          (click)="onDelete(complexValue, $event)"
          matTooltip="Delete complex value {{ complexValue.name }}"
          fontIcon="bosch-ic-delete"
        ></mat-icon>
      </div>
    </mat-panel-title>
  </mat-expansion-panel-header>
  <mat-action-row class="complex-value-table">
    <bci-table-container [showEmptyState]="complexValue.properties?.length === 0" emptyText="No Data">
      <mat-table [dataSource]="complexValue.properties" [trackBy]="trackProperty" bciTableStripedHorizontal>
        <!-- Property Name Column -->
        <ng-container matColumnDef="key">
          <mat-header-cell *matHeaderCellDef>Property</mat-header-cell>
          <mat-cell *matCellDef="let element">
            {{ element.key.property.name }}
          </mat-cell>
        </ng-container>
        <!-- Value Column -->
        <ng-container matColumnDef="value">
          <mat-header-cell *matHeaderCellDef>Value</mat-header-cell>
          <mat-cell *matCellDef="let element">
            {{ element.isComplex ? element.value.name : element.value }}
            <mat-icon
              *ngIf="element?.isComplex"
              class="complex-value-icon"
              fontIcon="bosch-ic-batch"
              matTooltip="Complex Data type"
            ></mat-icon>
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row
          (click)="selection.toggle(row)"
          *matRowDef="let row; columns: displayedColumns"
          [class.selected]="selection.isSelected(row)"
        ></mat-row>
      </mat-table>
    </bci-table-container>
  </mat-action-row>
</mat-expansion-panel>
<div *ngIf="complexValues?.length === 0">No entity values</div>
<div *ngIf="(complexValues | entityValue: searchFilter)?.length === 0">Entity values are filtered out.</div>
